define(function(e,t,n){"use strict";function v(e,t){navigator.notification?navigator.notification.alert(e,null,t):alert(e)}function b(e,t,n,i){if(n=n||"",navigator.notification)navigator.notification.prompt(e,function(e){t(1===e.buttonIndex?e.input1:null)},n,["Ok","Cancel"],i);else{var o=prompt(e,i,n);t(o)}}function x(e,t,n,i,o){if(n=n||"",navigator.notification)navigator.notification.confirm(e,function(e){t(1===e)},n,[i,o]);else{var a=confirm(e);t(a)}}function w(){var i=document.createElement("a");i.setAttribute("href","bingo.html"),i.click()}function k(){var e=i.range(1,10).map(function(e){var t="box"+e+"image",n="box"+e+"name";return{name:o.get(n),image:o.get(t)}});return e}function E(){return k().filter(function(e){return e.image})}function A(e,t){var n=new Image;n.onload=function(){var c=((r-n.width)/2,(l-n.height)/2,n.height*(r/n.width));i.select("#"+e).style("background-image","url("+t+")").style("background-size",r+"px "+c+"px")},n.src=t}function I(e,t){function o(e){return new Promise(function(i){e.classed(t,!0),setTimeout(function(){i(!0)},n)})}var a,n=350;return i.selectAll(e).each(function(){var e=i.select(this);a=a?a.then(function(){return o(e)}):o(e)}),a}function C(e,t){var n=(document.documentElement.clientHeight-3*r)/2,o=i.select("#alertContainer");o.style("display","block").style("top","-"+3*r+"px").on("click",null);i.select("#alertContainer img").attr("src",e).style("width",3*r+"px");o.on("click",function(){o.transition().duration(500).style("top","-1300px").each("end",function(){if(o.style("display","none"),i.select(".tile").classed("flip")){var e=I(".tile","unflip");e.then(function(){i.selectAll(".tile").classed("flip",!1)})}})}),o.transition().duration(2e3).style("top",n+"px").ease("bounce").each("end",function(){"function"==typeof t&&t()})}function H(){i.selectAll(".tile").classed("unflip",!1);var e=I(".tile","flip");e.then(function(){C("img/bingo.png")})}function O(e){var t=+e.substr(3),n=d[t].split("").some(function(e){return!o.get("box"+e+"image")});return!n}function S(e){var t=+e.substr(3),n=[1,3,7,9],i=n.indexOf(t)>=0&&n.every(function(e){return o.get("box"+e+"image")});return i}function D(e,t){function c(){setTimeout(function(){i.selectAll("#alertContainer").style("display","none")},750)}var l,r,a=+t.substr(3);A(t,e),o.set(t+"image",e),9===E().length?H():S(t)?(l=["#box1","#box3","#box7","#box9"],r=l.join(","),i.selectAll(r).classed("unflip",!1),I(r,"flip").then(function(){I(l.reverse().join(","),"unflip").then(function(){i.selectAll(r).classed("flip",!1)}),C("img/corners.png",c)})):O(t)&&(l=d[a].split("").map(function(e){return"#box"+e}),r=l.join(","),i.selectAll(r).classed("unflip",!1),I(r,"flip").then(function(){I(l.reverse().join(","),"unflip").then(function(){i.selectAll(r).classed("flip",!1)}),C("img/line.png",c)}))}function F(e){if(1==e.target.files.length&&0==e.target.files[0].type.indexOf("image/")){var t=e.target.files[0];EXIF.getData(t,function(){var e=EXIF.getTag(this,"Orientation"),n=new MegaPixImage(t),i=document.createElement("canvas");n.onrender=function(t){D(t.toDataURL(),a,e),a=""},n.render(i,{maxWidth:c,maxHeight:h,orientation:e})})}}function W(e){var t=i.select("#"+e+" .name"),n=t.html(),a="Enter the name of the person you want to meet: ",l="Name a face";b(a,function(n){null!==n&&(t.style("background","rgba(0,0,0,0.4)").html(n),o.set(e+"name",n))},l,n)}function q(){{var n=document.documentElement.clientWidth,i=document.documentElement.clientHeight;window.screen.width,window.screen.height}u=n,f=i-s,r=u/3,l=f/3,$("body").css({width:u+"px",height:f+"px"}),$(".tile, .back").css({width:r+"px",height:l+"px"})}function z(){$(".tile").on("click",function(e){if(e.target===this){var t=$("#"+this.id+" .name"),n=t.html();0===n.trim().length?W(this.id):(a=this.id,$("#photo-capture").click())}}),$("#photo-capture").on("change",F),$(".name").on("click",function(e){e.stopPropagation(),W(this.parentNode.id)}),$("#share").on("click",function(){var t=E();9===t.length?w():x("You haven't got a full house yet – share anyway?",function(e){e&&w()},"Share your image","Share anyway","Ok, I'll wait")}),$("#about").on("click",function(e){e.stopPropagation(),v(p,"About")})}function B(e,t){i.select("#"+e+" .name").html(t).style("background","rgba(0,0,0,0.4)")}function M(){i.selectAll(".tile").each(function(){var e=this.id,t=o.get(e+"name"),n=o.get(e+"image");t&&B(e,t),n&&A(e,n)})}var l,r,u,f,i=require("lib/d3.min"),o=require("Storage.min"),a="",c=600,s=40,h=250,p="CHI Bingo is a fun app that aims to increase social activity at CHI.\n\nThe aim is simple — before the conference, enter nine names of people you wish to talk to. When you arrive, the race is on to get 'selfie' photos with each of them before the conference ends. Easy!\n\nOnce you're done you can share your 9x9 grid with others.\n\nCHI Bingo was inspired by the late Gary Marsden — a CHI veteran and dear friend.",d={1:"123",2:"123",3:"123",4:"456",5:"456",6:"456",7:"789",8:"789",9:"789"},N={initialize:function(){this.bindEvents()},bindEvents:function(){$(document).ready(function(){M(),z(),q(),FastClick.attach(document.body)})},onDeviceReady:function(){},receivedEvent:function(){}};n.exports=N});