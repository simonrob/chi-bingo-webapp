require(["lib/d3.min","Storage.min"],function(t,e){"use strict";function u(t,e){navigator.notification?navigator.notification.alert(t,null,e):alert(t)}function g(){var c=document.documentElement.clientWidth,u=document.documentElement.clientHeight;window.screen.width,window.screen.height;r=c,o=u-l,a=r/3,i=o/3,t.select("body").style("width",r+"px").style("height",o+"px").style("margin","0").style("padding","0")}function m(n){var i=t.select("img#bingo");i.empty()&&(i=t.select("body").append("img").attr("id","bingo")),i.attr("src",n),i.attr("class","allow-download");var a=t.range(1,10).map(function(t){return e.get("box"+t+"name")}).filter(function(t){return t}),r="Just about to start my %23chi2017 %23bingo!";if(a.length>0){var o=a.reduce(function(t,e,n,i){var a=", ";return n===i.length-1&&(a=" and "),t?t.concat(a).concat(e):e}),c=a.length>1?" are ":" is ";r=o+c+"in my %23chi2017 %23bingo"}r="https://twitter.com/intent/tweet?text="+r.replace(" ","%20");var l=t.select("a#message");l.attr("href",r)}function f(e){function c(e){var o=e.map(function(t,e,n){return t.image?{width:a,height:t.image.height*a/t.image.width}:{width:0,height:0}}),c=o.reduce(function(t,e,n,i){var a=t[t.length-1];return a.length<3?a.push(e):t.push([e]),t},[[]]);console.log(JSON.stringify(c));var l=c.map(function(e){return t.max(e.map(function(t){return t.height}))||i}),u=a;n.width=3*u,n.height=l[0]+l[1]+l[2],r.fillStyle="white",r.fillRect(0,0,n.width,n.height),e.forEach(function(t,e){var i=e%3,a=Math.floor(e/3),c=i*u,g=l.slice(0,a).reduce(function(t,e){return t+e},0);t.image?r.drawImage(t.image,c,g,u,o[e].height):(r.save(),r.textAlign="center",r.fillStyle="white",r.fillRect(c,g,o[e].width,o[e].height),r.fillStyle="black",r.fillText(t.name||"?",c+u/2,g+l[a]/2,u),r.restore()),8===e&&m(n.toDataURL())})}function l(t){return new Promise(function(e,n){var i=new Image;t.image?(i.onload=function(){e({name:t.name,image:i})},i.onerror=function(t){n(t)},i.src=t.image):e({name:t.name})})}var n=document.createElement("canvas"),r=n.getContext("2d");Promise.all(e.map(function(t){return l(t)})).then(function(t){c(t)},function(t){u(JSON.stringify(t),"Error")})}function h(){var n=t.range(1,10).map(function(t){var n="box"+t+"image",i="box"+t+"name";return{name:e.get(i),image:e.get(n)}});return n}var i,a,r,o,l=40;g(),f(h())});