require(["lib/d3.min","Storage.min"],function(e,t){"use strict";function n(e,t){navigator.notification?navigator.notification.alert(e,null,t):alert(e)}function i(){var t=document.documentElement.clientWidth,n=document.documentElement.clientHeight;window.screen.width,window.screen.height;m=t,g=n-u,l=m/3,c=g/3,e.select("body").style("width",m+"px").style("height",g+"px").style("margin","0").style("padding","0")}function a(n){var i=e.select("img#bingo");i.empty()&&(i=e.select("body").append("img").attr("id","bingo")),i.attr("src",n),i.attr("class","allow-download");var a=e.range(1,10).map(function(e){return t.get("box"+e+"name")}).filter(function(e){return e}),r="Just about to start my %23chi2018 %23demobingo!";if(a.length>0){var o=a.reduce(function(e,t,n,i){var r=", ";return n===i.length-1&&(r=" and "),e=a.length>1?e.replace("Demo ","Demos "):e,t=t.replace("Demo ",""),e?e.concat(r).concat(t):t}),c=a.length>1?" are ":" is ";r=o+c+"in my %23chi2018 %23demobingo!"}r="https://twitter.com/intent/tweet?text="+r.replace(" ","%20");var l=e.select("a#message");l.attr("href",r)}function r(t){function i(t){var n=t.map(function(e,t,n){return e.image?{width:l,height:e.image.height*l/e.image.width}:{width:0,height:0}}),i=n.reduce(function(e,t,n,i){var a=e[e.length-1];return a.length<3?a.push(t):e.push([t]),e},[[]]);console.log(JSON.stringify(i));var r=i.map(function(t){return e.max(t.map(function(e){return e.height}))||c}),g=l;o.width=3*g,o.height=r[0]+r[1]+r[2],m.fillStyle="white",m.fillRect(0,0,o.width,o.height),t.forEach(function(e,t){var i=t%3,c=Math.floor(t/3),l=i*g,u=r.slice(0,c).reduce(function(e,t){return e+t},0);e.image?m.drawImage(e.image,l,u,g,n[t].height):(m.save(),m.textAlign="center",m.fillStyle="white",m.fillRect(l,u,n[t].width,n[t].height),m.fillStyle="black",m.fillText(e.name||"?",l+g/2,u+r[c]/2,g),m.restore()),8===t&&a(o.toDataURL())})}function r(e){return new Promise(function(t,n){var i=new Image;e.image?(i.onload=function(){t({name:e.name,image:i})},i.onerror=function(e){n(e)},i.src=e.image):t({name:e.name})})}var o=document.createElement("canvas"),m=o.getContext("2d");Promise.all(t.map(function(e){return r(e)})).then(function(e){i(e)},function(e){n(JSON.stringify(e),"Error")})}function o(){var n=e.range(1,10).map(function(e){var n="box"+e+"image",i="box"+e+"name";return{name:t.get(i),image:t.get(n)}});return n}var c,l,m,g,u=40;i(),r(o())});