require(["lib/d3.min","Storage.min"],function(e,t){"use strict";function s(e,t){navigator.notification?navigator.notification.alert(e,null,t):alert(e)}function u(){{var l=document.documentElement.clientWidth,s=document.documentElement.clientHeight;window.screen.width,window.screen.height}a=l,r=s-c,o=a/3,i=r/3,e.select("body").style("width",a+"px").style("height",r+"px").style("margin","0").style("padding","0")}function f(n){var i=e.select("img#bingo");i.empty()&&(i=e.select("body").append("img").attr("id","bingo")),i.attr("src",n),i.attr("class","allow-download");var o=e.select("a#message"),a=e.range(1,10).map(function(e){return t.get("box"+e+"name")}).filter(function(e){return e}),r=a.reduce(function(e,t,n,i){var o=", ";return n===i.length-1&&(o=" and "),e?e.concat(o).concat(t):t}),l=a.length>1?" are ":" is ",c=r+l+"in my %23chi2015 Bingo";c="https://twitter.com/intent/tweet?text="+c,o.attr("href",c)}function h(t){function l(t){var r=t.map(function(e){return e.image?{width:o,height:e.image.height*o/e.image.width}:{width:0,height:0}}),l=r.reduce(function(e,t){var o=e[e.length-1];return o.length<3?o.push(t):e.push([t]),e},[[]]);console.log(JSON.stringify(l));var c=l.map(function(t){return e.max(t.map(function(e){return e.height}))||i}),s=o;n.width=3*s,n.height=c[0]+c[1]+c[2],a.fillStyle="white",a.fillRect(0,0,n.width,n.height),t.forEach(function(e,t){var i=t%3,o=Math.floor(t/3),l=i*s,u=c.slice(0,o).reduce(function(e,t){return e+t},0);e.image?a.drawImage(e.image,l,u,s,r[t].height):(a.save(),a.textAlign="center",a.fillStyle="white",a.fillRect(l,u,r[t].width,r[t].height),a.fillStyle="black",a.fillText(e.name||"?",l+s/2,u+c[o]/2,s),a.restore()),8===t&&f(n.toDataURL())})}function c(e){return new Promise(function(t,n){var i=new Image;e.image?(i.onload=function(){t({name:e.name,image:i})},i.onerror=function(e){n(e)},i.src=e.image):t({name:e.name})})}var n=document.createElement("canvas"),a=n.getContext("2d");Promise.all(t.map(function(e){return c(e)})).then(function(e){l(e)},function(e){s(JSON.stringify(e),"Error")})}function g(){var n=e.range(1,10).map(function(e){var n="box"+e+"image",i="box"+e+"name";return{name:t.get(i),image:t.get(n)}});return n}var i,o,a,r,c=40;u(),h(g())});